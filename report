1/20/2017 5:51:26 PM     C:\code\report

Top shelf:
=========
[ ] sat/rate_lim -> Attitude Indicator.
    DevBr_PitchMods_Merge_Ver2 => AttitudeIndicator2

[ ] MCP Coeff changer -> after condensing strings :::: broken build macros => OK in HdgHoldProf
    DevBr_PitchMods_Merge_Ver2 => Coeff_Mgmt_Test.c, CoeffChanger

[ ] PR_3576: add print macros to src 

Jumpstart:
=========
[ ] Need saturation and rate limit flags in Telemetry and Attitude Indicator.
[ ] Place constants and strings into coefficient file and free up executable space.
[+] Update unit tests for new pitch inner loop & ADAHRS
[+] Automate Matlab coefficient builder
[+] Maintenance Application needs to display selectable raw sensor data
[+] Create system timing profmap to baseline for regression testing - prof.inc
[?] Stack Monitoring - stack.inc (global int call_depth)
[?] Automate Flight Test Data Analysis

remember: http://processors.wiki.ti.com/index.php/Project_Macros

Merging HdgHold to DevBr: [M:\prj\prs\HdgHoldMerge]
========================

[1376] Altitude Env Prot: Revs(18079 -> 19354 -> 20186) : C:\helitrak\PR1376_Merge
    http://hltrk-bugzilla01/show_bug.cgi?id=1376
    Altitude Hold Envelope Protection (previously known as Heading-only mode)
    [x] File list - [x] WAS/IS - [ ] zips to PR [ ] Peer Rvw - [ ] CCB Q - [ ] Needs Rqmts
[3829] Roll_Target_Gen: cunit and munit - OL & IL (feedback)
    http://hltrk-bugzilla01/show_bug.cgi?id=3829
    Heading Hold performance does not meet requirements
    [x] File list - [x] WAS/IS - [ ] zips to PR [ ] Peer Rvw - [ ] CCB Q - [ ] Needs Rqmts
[4048] Pitch Control Law architecture incorrect IL
    http://hltrk-bugzilla01/show_bug.cgi?id=4048

Add comments with links.

[4045] HAP_unit_test.h => HAP1_Unit_Test.h is incompatible with Visual Studio 2013 and greater
    http://hltrk-bugzilla01/show_bug.cgi?id=4045
    HAP1_Unit_Test.h is incompatible with Visual Studio 2013 and greater
    [x] File list - [x] WAS/IS - [ ] zips to PR [ ] Peer Rvw - [ ] CCB Q - [ ] Needs Rqmts
[3818] Fault_Enum literals
    http://hltrk-bugzilla01/show_bug.cgi?id=3818
    SHOW_FAULT_ENUMS option is not printing the enum string in all cases 
    [x] File list - [x] WAS/IS - [ ] zips to PR [ ] Peer Rvw - [ ] CCB Q - [ ] Needs Rqmts
[4046] Fixed button control logic
    http://hltrk-bugzilla01/show_bug.cgi?id=4046
    User input bit flags erroneously being treated as values instead of bitfields.
    [x] File list - [x] WAS/IS - [ ] zips to PR [ ] Peer Rvw - [ ] CCB Q - [ ] Needs Rqmts

ToDo: ****************************************************************

[3576] SVN version CAN spew
    => M:\prj\prs\HdgHold_HdgHoldProf_Merge: 3576.diff needs engrg to clean branch and merged.
    http://hltrk-bugzilla01/show_bug.cgi?id=3576
    In DEBUG builds, need to print branch identifier to CAN bus.
    [x] File list - [x] WAS/IS - [ ] update headers - [ ] zips to PR [ ] Peer Rvw - [ ] CCB Q

[  ] Need profiling     

**********************************************************************

Extras:
======
[ ] Coeff builder calculator
[ ] Coeff builder getter
[ ] Coefficient matlab builder
[ ] tracer.c ==> prof.inc
[ ] other stuff in HdgHold and HdgHoldProf    
    ??? ADP\Annunciators_IBIT.c -- light up annunciator, 
    new CAN_DEMUX2
    new build types: coeff builds for all types
    CoeffChanger: now supports MCP
    MaintenanceDisplay: supports scripting

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
summary to do:
[ ] merge mxapp => can_demux POC
[ ] coefficient builder
    C:\helitrak\HdgHold\SimModel\HAP\Autopilot_ARCH_ADP_RollTargetGen_setCfgValues.m
[ ] unit tests: roll control
[ ] ambient light cal: => y:ambient2.ino
    => user input: gain and integration time
[ ] HdgHoldCRC -- OMG debug this
[ ] SP & PP different tones : HdgHoldTone
[ ] LCD STM board - start w/pure demo code, update tool chain
[ ] debug PFM release build on jenkins - works locally on HdgHold
[ ] requirements - diff trunk w/devbr
[ ] rs485 remote mag
[ ] mcp overdet: full hardware support ...
[ ] button cal code support
[ ] dimmer cal code support
[ ] @home p.o.c. WxPython & DLL Mx_App

[ ] vim report gen: :tabnew !ls

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
[ ] Goals
    [ ] complete todo list for a/p cert: tools & estimates
    [ ] requirements - diff trunk w/devbr
    [ ] rs485
    [ ] IL test flights to assess need for gain sched: speed/alt/wt => IL tuning
    [ ] use feedback_run w/0 gain for 2nd integrator (pitch)
    [ ] mcp overdet: full hardware support ...
    [ ] ambient light cal: => y:ambient2.ino
        ==> plot curves for each gain
        TSL2591_GAIN_LOW   = 0x00, // low gain (1x)
        TSL2591_GAIN_MED   = 0x10, // medium gain (25x)
        TSL2591_GAIN_HIGH  = 0x20, // medium gain (428x)
        TSL2591_GAIN_MAX   = 0x30, // max gain (9876x)
    [ ] button cal code support
        USER_INPUT_HW_COEFF_STRUCT:
            F32 minimum_voltage_loop_a; // LOOP_A voltages below this number will be ignored.
            F32 minimum_voltage_loop_b; // voltages below this number will be ignored
            F32 button_range_lower;     // multiplier for a buttons lower limit
            F32 button_volts_up;        // voltage seen for UP button
            F32 button_volts_left;      // voltage seen for LEFT button
            F32 button_volts_mode;      // voltage seen for MODE button
            F32 button_volts_engage1;   // voltage seen for ENGAGE button #1
            F32 button_volts_down;      // voltage seen for DOWN button
            F32 button_volts_right;     // voltage seen for RIGHT button
            F32 button_volts_engage2;   // voltage seen for ENGAGE button #2
        USER_INPUT_COEFF_STRUCT:
            //switch coeff for non-eng/dis PCI buttons
            MOMENTARY_SWITCH_COEFF_STRUCT momentary_switch;
                U32 debounce_threshold; // Threshold, in frames, of the debounce time
                U32 sustain_threshold;  // Threshold, in frames, of the sustain time
                // Coefficients for the falling edge one-shot
                PERSISTENT1SHOT_COEFF_STRUCT switch_opened_one_shot_coeff;
                    U32 P;				  // cycles of persistence
                    BOOLEAN ic; 	      // initial condition
                    BOOLEAN rising_edge;  // trigger on rising edge
                    BOOLEAN falling_edge; // trigger on falling edge
            //switch coeff for eng/dis buttons
            MOMENTARY_SWITCH_COEFF_STRUCT momentary_switch_eng_dis;
                U32 debounce_threshold; // Threshold, in frames, of the debounce time
                U32 sustain_threshold;  // Threshold, in frames, of the sustain time
                // Coefficients for the falling edge one-shot
                PERSISTENT1SHOT_COEFF_STRUCT switch_opened_one_shot_coeff;
                    U32 P;				  // cycles of persistence
                    BOOLEAN ic; 	      // initial condition
                    BOOLEAN rising_edge;  // trigger on rising edge
                    BOOLEAN falling_edge; // trigger on falling edge
    [ ] dimmer cal code support
        st_ptr->annunciators_coeff.display_brightness_offset = 0.3f;
        st_ptr->annunciators_coeff.display_brightness_scaling = 1.0f;
        st_ptr->annunciators_coeff.ext_dimmer_low_pass_filter_alpha = 1.0f / 10.0f;
        st_ptr->annunciators_coeff.light_sensor_low_pass_filter_alpha = 1.0f / 200.0f;

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
accomplishments since march thru december:
added code to outer loop & inner loop: roll control, feedback
added unit tests: ReIntICHS, SatVF, RollCtrl
debugged simulator - blue board & STM
added script interface to mx app
modified attitude indicator to have airspeed & altitude: HdgHoldProf
automated rebuild of hap1 files on build
shrunk mfg code by abbreviating debug strings
debugged SHOW_FAULT_ENUMS
added override detection
merged envelope protection into devbr
debugged PCI button code
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
accomplishments starting december:
[x] added 3 JTAG blackhawks to helicopter for MCP programming

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

[ ] ReIntICHS unit test - jeffs:
http://subversion.helitrak.com/svn/HAP1-CERT/branches/jeffrey/
    JeffsDevBr_HdgHoldProblem/SimModel/DEV/HLIB/ReInt/ReInt_ICHS_unitTest
    compare code with Jeffs model and matlab code
    run MatLab unit test
    run C unit test against csv

[ ] Merge into HdgHold branch
    [ ] svn spew -> perl build              -> FTC_CPD_4_BR_SVN_SPEW
    [x] in_flight_tools                     -> this
    [ ] mfg fixes -> string compression     -> DevBrMfg
    [ ] override detection w/build target   -> OL38_OverDet

[ ] IL refactor:
    C code
    ======
    C:/helitrak/HdgHold/SWDev/MCP/Source/User_Input.c
    C:/helitrak/HdgHold/SWDev/Model/Inner_Loop/Source/Feedback.c
    C:/helitrak/HdgHold/SWDev/Model/Inner_Loop/Source/MCP_CLaw_coeff.c
    C:/helitrak/HdgHold/SWDev/Model/Inner_Loop/Source/Cyclic_Feedback.c
    C:/helitrak/HdgHold/SWDev/Model/Inner_Loop/Header/Cyclic_Feedback.h

    Matlab
    ======
    C:/helitrak/HdgHold/SimModel/HAP/Autopilot_ARCH_MCP_IL.mdl
    C:/helitrak/HdgHold/SimModel/HAP/Autopilot_ARCH_MCP_IL_CyclicFB.mdl
    C:/helitrak/HdgHold/SimModel/HAP/Autopilot_ARCH_MCP_SC.mdl
    C:/helitrak/HdgHold/SimModel/HAP/Autopilot_ARCH_MCP.mdl

    Notes:
    Add module TestPort Block and Unit Test (w/AES CanDemux, Mx_App) ServoController
        switch between: inner_loop_cmd & (inner_loop_cmd+step)


[ ] debug PFM release build on jenkins - repros locally -- bad relative path -- fixed(see logs)
        MCP succeeds
        ADP fails -- see logs m:\prj\PFM_debug --> now fails 
        "C:\helitrak\PFMReleaseBuildFix\SWDev\Tools\MX_Code\PersonalityFileMaker\
            PersonalityFileMaker\Serializer.h", 
        line 143: warning #562-D: "typeid" is reserved for future use as a keyword
        "C:\helitrak\PFMReleaseBuildFix\SWDev\Tools\MX_Code\PersonalityFileMaker\
            PersonalityFileMaker\Serializer.h", 
        line 143: error #256: type name is not allowed

[x] HdgHold: PSI offset: New telemetry to fix HDG wander/offset
    -> HDG roll rate, heading rate, current target and error
    -> ROLL target (s/b zero), error
    steps: 70 knots, S&L, 18" manifold pressure, engage
    repro: turns left about 10 deg
    thoughts: OL integrator coeff too low
              IL fighting OL
    setup: run attitude indicator app & print attitude Psi @ engage

[x] find arrays init'd with fault_enums -> in motor test - file pr
    => Actuator_Get_Fault_For_Code ==> hides FAULT_ENUMs
            FAULT_ENUM fault_type = Actuator_Get_Fault(&act_mod_tst->phase_struct);
            Fault_Mgmt_Set_Fault(fault_type);
        instead:
            FAULT_ENUM fault_type = Actuator_Set_Fault(&act_mod_tst->phase_struct);
                Fault_Mgmt_Set_Fault(fault_type);

[x] PR 3818: SHOW_FAULT_ENUMS option is not printing the enum string in all cases
    ==> create macro for these functions --> wrap all parms in ()
    [OL38_OverDet] Sensor_Mgmt.c::Sensor_Mgmt_Run_Sample_Rate_Sanity_Check
    [OL38_OverDet] Signals_ADP.c::Signals_Sensor_Update_Fault_Handling

[x] PR 2993: MfgTest builds are out of code space

[ ] debug spew from STMicro to debug console

[ ] ==> DevBrMfg <== C:\helitrak\MfgBuild
    [x] Signals_Sensor_Update_Fault_Handling <== needs to be macro
        Signals_ADP macro sensor faults => 0x12 & 0x14 ==> SHOW_FAULT_ENUMS
        => Fault_Mgmt_Set_Fault uses text of enum

[ ] code re-engagement design
    Op_Mode_Support_Run
        USER_INPUT_CMD_BITFLAGS median = User_Input_Get_Median_Cmd_Bitflags();//PCI buttons active
        if (engage_loop_1_pressed && engage_loop_2_pressed)
            System_Log_Increment_Engaged_Count();
            System_Log_Set_Flag(SYSFLAG_ENGAGED, TRUE);
            // Start engaging the clutches.
            => on engage in MCP : Actuator_Mgmt_Clutches_Engage
            Actuator_Mgmt_Clutches_Engage();
                Clutch_Control_Engage();
                am_state_ptr->engage_init_needed        = TRUE;
                am_state_ptr->override_braking_counter  = 0;
    also see outer_loop\mode_logic
    MCP_Set_Run(Actuator_Mgmt_Are_Clutches_Engaged()); => starts ADP running
    // ADP flies the helicopter: HDG_HOLD, ALT_HOLD, SPD_HOLD
    // how is ADP navigation notified of override?

[ ] discuss w/Tom the Light Sensor Auto Dimming feature

[ ] OL38_OverDet: see notes in override_detection project
    --> #ifdef experimental code
    -->   need to remember cyclic position and return when override is removed
    -->   create a runtime mapping of cyclic position[airspeed] for straight/level
    -->   start w/unit tests: 2d linterp + 2nd order switch (exp code)
    -->   assess code space savings
    --> #endif
    -> ADP pin for override detection
    -> zero point at engagement
    -> need monoStableFlipFlop (latch) MCP Post pin off for post so no alias
    -> 1 frame delay: Main_MCP: Actuator_Mgmt_Run + MCP_To_ADP_Service_ADP_In
    -> ADP:IPC_Construct_Message -> MCP:MCP_To_ADP_Process_ADP_Message 
                                 -> Actuator_Mgmt_Set_Override_Detected

[ ] Comp_Filter_Nth_Order: simplify to 1st, 2nd, 3rd order instances
    --> start w/unit tests

[ ] OL38_Merge_DevBr merged into main branch --> CCB should be done (see Bob)
    (Altitude hold envelope protection)
    + altitude comp filter  -> altitude hold
    + speed comp filter     -> speed hold
    + true air speed
    + vertical rate

[ ] PR 3576 Add CAN SVN spew to bartb\FTC_CPD_4_BR_SVN_SPEW => DEBUG and RELEASE mode
    find DOORS rqmt & runs in debug & release
[ ] PCI Cal debug: -> diff PCI calibrator w/three axis calibrator - diff dirs
[ ] fix coeff generators: ADP/MCP: hcoeff_adp_claw.m/hcoeff_mcp_claw.m
[ ] PR 3303 HAP1-SDD-ADP: Inter_Proc_Comm_ADP: 0.19- OID’s are of type ‘TBD’
    ==> schedule live CCB meeting for this one.

[>reqts] 3292 in Inter_Proc_Comm_MCP.h, malformed Requirement tag
    In http://subversion.helitrak.com/svn/HAP1-CERT/System/SWDev/MCP/Header/Inter_Proc_Comm_MCP.h
    /** ===========================================================================
    \struct  SYSTEM_IPC_POST_STRUCT
    \brief    Holds the CRC data passed in the data Ring Message for a single MCP.
              (data: 4 bytes)             
    \MCPReqt{HAP1-SDD-MCP,}
    Totally undefined, need to DD item in SDD-MCP

[>reqts] 3294 In Steam_IO_MCP.c, malformed Requirement tag
    In http://subversion.helitrak.com/svn/HAP1-CERT/System/SWDev/MCP/Source/Stream_IO_MCP.c
    /** ========================================================================
    \def FRAM1
    \brief Struct representing remote FRAM device #1
    \MCPReqt{HAP1-SDD-MCP,xxx}
    Totally undefined, need to DD item in SDD-MCP

[rdy4ccb] 2509 - Phase Timing: PR development tool: bartb/DevBrProfiler
    [ ] see PP files for macro troubleshooting
    [ ] save peer comments, prep for CCB
    [x] search for printf variants in autopilot
    add more comments
    chg: measured = phases[i].avg + (NUM_STD_DEV_SAMPLE*phases[i].stdev);
    absorb sola's utilization into profiler
    add unit tests

HAP Certification
    [x] ADAHRS ARCH Reqts : Jeffrey, Michael, Bart
    [ ] Outer Loop ARCH Reqts : Bart, Jeffrey
    [ ] Dimmer Calibration : Bart --> see Tom
    [ ] Altitude Hold Envelope Protection : Ray, Bart
    [ ] Speed Complementary Filter : Bart
    [ ] Altitude Complementary Filter : Bart
    [ ] PCI resistor update : Tom, Bart
    [ ] PCI Calibration : Samir
    [ ] Unit tests: 6 ADAHRS + 3 OL

[  ] Research for post-FLT039
    [ ] Add telemetry flags for limiters in OL pipeline
    [ ] 2 bits / flag (hi/low)
    [ ] file PR for this addition to telemetry
[ ] Research new feature
    [ ] vertical speed term - in gust - no push over (pitch)
    [ ] essentially a G-limit on OL pitch control -- see inner loop G-limiter
[ ] Outer Loop
    [ ] Env Prot -> Altitude hold mode
    [ ] Hdg Comp Fltr : 15 days
    [ ] Roll Control  : test harness
        [ ] Matlab
        [ ] Unittest - hand generated vectors (sinewave) match autopilot w/model
[ ] audit of board serialization process
[ ] checkin coeffs
    -> SIM: trk prop    2.3375
            trk int     0.1450
            alt prop    0.0135
            alt int     0.0005
    -> FLT: trk prop    2.5375
            trk int     0.1250
            alt prop    ??????
            alt int     ??????
[ ] debug coeff_builders && trace outer loop Gains => sample time mismatches --> +ZOHs

*** notes: COM6,uname:unamehelitrak
** @@ Main_MCP.c  -> Fault_Mgmt_Set_Fault(FAULT_MULTIPLE_LEVEL_THREE_FAULTS);
** @@ MCP_State.c -> Fault_Mgmt_Set_Fault(FAULT_MCP_POST);
5 new feats: new mag, spd comp fltr, tuning, cpd integ, override detect, trunk bld, dimmer cal
https://www.mediawiki.org/wiki/Help:Formatting
http://www.ircbeginner.com/ircinfo/ircc-commands.html <== webchat.freenode.net commands
mstsc:understand-pc -> software schedules
    open -> ( ) Y:\Project Management\Schedule\HAP1_Software_Schedule.mpp
PERS: RaspPi power supply, reader=http://bravegnu.org/gnu-eprog/
0========1=========2=========3=========4=========5=========6=========7=========8=========9=========0

accelerometer on mag board is not used - remove app code
mag/install/calibrate -> earth's mag field strength - dip angle vs down vector: noaa.org, 
                            helmholtz coil

fs01\helitrak\projectmgmt\schedule\helitrakschedule\R&D projects
    outer loop, ADAHRS, PR dispostion, flight tests, SIL
ARCH-OL -> Roll control :: diff DevBr and FTC 20

Reminder of where everything lives:
[ ] checkins:
    ConfigDumper CRCs -> TelemetryV2
    database for CRCs/Branch/Serial Numbers -> toys\py (sqlite)
        => F:\apps\DataLite\DataLite
    Phase timing -> bartb\FTC_CPD_4_BR
    Branch CAN spew -> bartb\HdgHold
    Eyes => -> TelemetryV2
    Fault calculator -> TelemetryV2
    Override detection -> OL38_OverDet
    Getter for calibration coeffs -> HdgHoldProf

http://www.hanselman.com/blog/ScottHanselmans2014UltimateDeveloperAndPowerUsersToolListForWindows.aspx

bartbh*k

SW Tools:
========
Maintenance Application
Download Log
Decode Error Codes (diagnose issues)
Clear Log
Installation Calibration
Add Manufacturing Calibration data to Matlab Test Script
Display Autopilot Statistics
Capture Debug Info (including startup messages, software version, etc.)
Installation Configuration/Test/Debug
Investigate reducing producing 3 MCP HAP personality files to a single HAP personality file.
[edit]Manufacturing Calibration Application
Remote Magnetometer Manufacturing Calibration Application
Manufacturing/Diagnostic POST Application
Coefficient Changer
Add an option in the CoeffChanger for entering a value in degrees and having it convert to radians and set the value.
Add a display of the current value instead of having to look at the terminal printout to see the values.
Flight Test Video Data Extraction

